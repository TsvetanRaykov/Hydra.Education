import{top,left,right,bottom,start}from"../enums.js";import getBasePlacement from"../utils/getBasePlacement.js";import getMainAxisFromPlacement from"../utils/getMainAxisFromPlacement.js";import getAltAxis from"../utils/getAltAxis.js";import within from"../utils/within.js";import getLayoutRect from"../dom-utils/getLayoutRect.js";import getOffsetParent from"../dom-utils/getOffsetParent.js";import detectOverflow from"../utils/detectOverflow.js";import getVariation from"../utils/getVariation.js";import getFreshSideObject from"../utils/getFreshSideObject.js";import{max as mathMax,min as mathMin}from"../utils/math.js";function preventOverflow(t){var e=t.state,i=t.options,r=t.name,o=i.mainAxis,a=void 0===o||o,s=i.altAxis,m=void 0!==s&&s,n=i.boundary,f=i.rootBoundary,l=i.altBoundary,p=i.padding,d=i.tether,g=void 0===d||d,c=i.tetherOffset,h=void 0===c?0:c,u=detectOverflow(e,{boundary:n,rootBoundary:f,padding:p,altBoundary:l}),w=getBasePlacement(e.placement),x=getVariation(e.placement),j=!x,y=getMainAxisFromPlacement(w),O=getAltAxis(y),v=e.modifiersData.popperOffsets,A=e.rects.reference,t=e.rects.popper,o="function"==typeof h?h(Object.assign({},e.rects,{placement:e.placement})):h,s={x:0,y:0};v&&((a||m)&&(d="y"===y?top:left,i="y"===y?bottom:right,c="y"===y?"height":"width",n=v[y],f=v[y]+u[d],p=v[y]-u[i],l=g?-t[c]/2:0,w=(x===start?A:t)[c],h=x===start?-t[c]:-A[c],x=e.elements.arrow,t=g&&x?getLayoutRect(x):{width:0,height:0},d=(x=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:getFreshSideObject())[d],i=x[i],t=within(0,A[c],t[c]),d=j?A[c]/2-l-t-d-o:w-t-d-o,t=j?-A[c]/2+l+t+i+o:h+t+i+o,o=(i=e.elements.arrow&&getOffsetParent(e.elements.arrow))?"y"===y?i.clientTop||0:i.clientLeft||0:0,i=e.modifiersData.offset?e.modifiersData.offset[e.placement][y]:0,o=v[y]+d-i-o,i=v[y]+t-i,a&&(p=within(g?mathMin(f,o):f,n,g?mathMax(p,i):p),v[y]=p,s[y]=p-n),m&&(n="x"===y?top:left,m="x"===y?bottom:right,n=(y=v[O])+u[n],m=y-u[m],m=within(g?mathMin(n,o):n,y,g?mathMax(m,i):m),v[O]=m,s[O]=m-y)),e.modifiersData[r]=s)}export default{name:"preventOverflow",enabled:!0,phase:"main",fn:preventOverflow,requiresIfExists:["offset"]};